@model IEnumerable<KitapSatisSitesi.Models.Siparis>
@{
    ViewData["Title"] = "Siparişlerim";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">
                <i class="fas fa-shopping-bag me-2"></i>Siparişlerim
            </h1>

            @if (!Model.Any())
            {
                <div class="alert alert-info text-center">
                    <i class="fas fa-shopping-bag fa-3x mb-3"></i>
                    <h4>Henüz Siparişiniz Yok</h4>
                    <p>İlk siparişinizi vermek için alışverişe başlayın.</p>
                    <a href="@Url.Action("Index", "Kitap")" class="btn btn-primary">
                        <i class="fas fa-book me-2"></i>Alışverişe Başla
                    </a>
                </div>
            }
            else
            {
                <div class="row">
                    @foreach (var siparis in Model)
                    {
                        <div class="col-md-6 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-receipt me-2"></i>Sipariş #@siparis.SiparisID
                                    </h6>
                                    <span class="badge bg-@(siparis.Durum == "Beklemede" ? "warning" : siparis.Durum == "Tamamlandı" ? "success" : "info")">
                                        @siparis.Durum
                                    </span>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h6 class="card-title">Sipariş Detayları</h6>
                                            <p class="card-text">
                                                <strong class="text-primary">₺@siparis.ToplamTutar.ToString("F2")</strong>
                                            </p>
                                            <p class="card-text">
                                                <small class="text-muted">
                                                    <i class="fas fa-calendar me-1"></i>
                                                    @siparis.SiparisTarihi.ToString("dd.MM.yyyy HH:mm")
                                                </small>
                                            </p>
                                            <p class="card-text">
                                                <small class="text-muted">
                                                    <i class="fas fa-box me-1"></i>
                                                    @siparis.SiparisDetaylar.Count() ürün
                                                </small>
                                            </p>
                                            
                                            <!-- Kitaplar Önizleme -->
                                            <div class="mt-3">
                                                <h6 class="text-muted mb-2">Alınan Kitaplar:</h6>
                                                <div class="row">
                                                    @if (siparis.SiparisDetaylar.Any())
                                                    {
                                                        @foreach (var detay in siparis.SiparisDetaylar.Take(3))
                                                        {
                                                            <div class="col-md-4 mb-2">
                                                                <div class="d-flex align-items-center">
                                                                    <img src="@(string.IsNullOrEmpty(detay.Kitap.ResimUrl) ? "https://via.placeholder.com/40x50/6c757d/ffffff?text=Kitap" : 
                                                                            (detay.Kitap.ResimUrl.StartsWith("http://") || detay.Kitap.ResimUrl.StartsWith("https://") ? detay.Kitap.ResimUrl : (detay.Kitap.ResimUrl.StartsWith("/") ? detay.Kitap.ResimUrl : "/" + detay.Kitap.ResimUrl)))" 
                                                                         class="img-thumbnail me-2" style="width: 40px; height: 50px; object-fit: cover;" alt="@detay.Kitap.Ad">
                                                                    <div>
                                                                        <small class="fw-bold">@detay.Kitap.Ad</small><br>
                                                                        <small class="text-muted">@detay.Adet adet</small>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                        @if (siparis.SiparisDetaylar.Count() > 3)
                                                        {
                                                            <div class="col-md-4 mb-2">
                                                                <div class="d-flex align-items-center">
                                                                    <div class="text-center">
                                                                        <small class="text-muted">+@(siparis.SiparisDetaylar.Count() - 3) kitap daha</small>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                    }
                                                    else if (siparis.Kitap != null)
                                                    {
                                                        <div class="col-md-4 mb-2">
                                                            <div class="d-flex align-items-center">
                                                                <img src="@(string.IsNullOrEmpty(siparis.Kitap.ResimUrl) ? "https://via.placeholder.com/40x50/6c757d/ffffff?text=Kitap" : 
                                                                        (siparis.Kitap.ResimUrl.StartsWith("http://") || siparis.Kitap.ResimUrl.StartsWith("https://") ? siparis.Kitap.ResimUrl : (siparis.Kitap.ResimUrl.StartsWith("/") ? siparis.Kitap.ResimUrl : "/" + siparis.Kitap.ResimUrl)))" 
                                                                     class="img-thumbnail me-2" style="width: 40px; height: 50px; object-fit: cover;" alt="@siparis.Kitap.Ad">
                                                                <div>
                                                                    <small class="fw-bold">@siparis.Kitap.Ad</small><br>
                                                                    <small class="text-muted">1 adet</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-md-12">
                                                            <small class="text-muted">Ürün bilgisi bulunamadı</small>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <a href="@Url.Action("Detay", new { id = siparis.SiparisID })" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-eye me-1"></i>Detayları Gör
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div> 